<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>D·ª± ƒëo√°n SunWin VIP - B·∫£n Quy·ªÅn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <link rel="icon" href="https://iqai.com/_next/image?url=/gifs/home/robotics.gif&w=828&q=75" type="image/png" />
  
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: #0f2a33;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
      overflow: hidden;
    }

    /* ===== AUTH SCREEN ===== */
    #authScreen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #0f2a33, #1a3a45);
      z-index: 10000;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .auth-box {
      background: rgba(10, 25, 30, 0.98);
      border-radius: 16px;
      padding: 40px 35px;
      width: 100%;
      max-width: 450px;
      border: 1px solid rgba(79, 209, 197, 0.4);
      box-shadow: 
        0 0 40px rgba(79, 209, 197, 0.35),
        inset 0 0 20px rgba(79, 209, 197, 0.15);
    }

    .logo img {
      width: 75px;
      border-radius: 50%;
      filter: drop-shadow(0 0 12px #4fd1c5);
      display: block;
      margin: 0 auto 25px;
    }

    h1 {
      color: #81e6d9;
      text-align: center;
      margin-bottom: 8px;
      font-size: 22px;
      text-shadow: 0 0 8px rgba(79,209,197,0.7);
    }

    .subtitle {
      color: #a0aec0;
      text-align: center;
      font-size: 14px;
      margin-bottom: 30px;
    }

    .input-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      color: #81e6d9;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
      text-shadow: 0 0 4px rgba(79,209,197,0.5);
    }

    input {
      width: 100%;
      padding: 14px 16px;
      background: rgba(15, 42, 51, 0.8);
      border: 2px solid rgba(79, 209, 197, 0.4);
      border-radius: 10px;
      color: #e6fffa;
      font-size: 16px;
      outline: none;
      transition: all 0.3s;
    }

    input:focus {
      border-color: #4fd1c5;
      box-shadow: 0 0 15px rgba(79, 209, 197, 0.5);
    }

    .btn-auth {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #4fd1c5, #38b2ac);
      border: none;
      border-radius: 10px;
      color: #0f2a33;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
    }

    .btn-auth:hover {
      background: linear-gradient(135deg, #38f9d7, #4fd1c5);
      box-shadow: 0 0 20px rgba(79, 209, 197, 0.7);
    }

    .btn-auth:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .error-message {
      color: #fc8181;
      text-align: center;
      font-size: 14px;
      margin-top: 15px;
      min-height: 20px;
      text-shadow: 0 0 4px rgba(252, 129, 129, 0.5);
    }

    .loading {
      color: #81e6d9;
      text-align: center;
      font-size: 14px;
      margin: 15px 0;
    }

    /* ===== MAIN APP ===== */
    #mainApp {
      display: none;
    }

    iframe {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      border: none;
      z-index: 1;
    }

    #robotBox {
      position: fixed;
      top: 90px;
      left: 20px;
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: move;
      user-select: none;
      padding: 12px 16px;
      border-radius: 20px;
      background: linear-gradient(
        135deg,
        rgba(79,209,197,0.18),
        rgba(56,178,172,0.12)
      );
      backdrop-filter: blur(10px);
      border: 1px solid rgba(79,209,197,0.35);
      box-shadow:
        0 0 15px rgba(79,209,197,0.5),
        0 0 35px rgba(79,209,197,0.25);
    }

    #robotIcon {
      width: 70px;
      filter:
        drop-shadow(0 0 10px #4fd1c5)
        drop-shadow(0 0 20px #38b2ac);
    }

    #predictionCard {
      background: linear-gradient(
        180deg,
        rgba(10,25,30,0.95),
        rgba(5,15,20,0.98)
      );
      border-radius: 14px;
      padding: 12px 16px;
      min-width: 200px;
      border: 1px solid rgba(79,209,197,0.3);
      box-shadow:
        inset 0 0 12px rgba(79,209,197,0.15),
        0 0 20px rgba(79,209,197,0.25);
    }

    #phien {
      color: #81e6d9;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
      text-shadow: 0 0 6px rgba(79,209,197,0.6);
    }

    #duDoan {
      font-size: 18px;
      font-weight: 800;
      color: #e6fffa;
      text-shadow:
        0 0 8px rgba(79,209,197,0.9),
        0 0 16px rgba(79,209,197,0.6);
    }

    #cauStatus {
      color: #a0aec0;
      font-size: 11px;
      font-style: italic;
      margin-top: 4px;
    }

    .du-doan-tai {
      color: #38f9d7 !important;
      text-shadow:
        0 0 10px rgba(56,249,215,0.9),
        0 0 20px rgba(56,249,215,0.6);
    }

    .du-doan-xiu {
      color: #f6ad55 !important;
      text-shadow:
        0 0 10px rgba(246,173,85,0.9),
        0 0 20px rgba(246,173,85,0.6);
    }

    #copyright {
      position: fixed;
      bottom: 10px;
      right: 10px;
      color: #81e6d9;
      font-size: 11px;
      z-index: 9999;
      opacity: 0.85;
      user-select: none;
    }

    #logoutBtn {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
      padding: 8px 16px;
      background: rgba(10, 25, 30, 0.9);
      border: 1px solid rgba(252, 129, 129, 0.4);
      border-radius: 8px;
      color: #fc8181;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s;
    }

    #logoutBtn:hover {
      background: rgba(252, 129, 129, 0.1);
      border-color: #fc8181;
      box-shadow: 0 0 10px rgba(252, 129, 129, 0.4);
    }
  </style>
</head>

<body>
  <!-- AUTH SCREEN -->
  <div id="authScreen">
    <div class="auth-box">
      <div class="logo">
        <img src="https://iqai.com/_next/image?url=/gifs/home/robotics.gif&w=828&q=75" alt="AI Robot" />
      </div>
      <h1>üîê TRUY C·∫¨P VIP</h1>
      <p class="subtitle">Nh·∫≠p key b·∫£n quy·ªÅn ƒë·ªÉ s·ª≠ d·ª•ng c√¥ng c·ª•</p>
      
      <div class="loading" id="loadingStatus">üì° ƒêang t·∫£i danh s√°ch key...</div>
      
      <div class="input-group">
        <label for="keyInput">KEY B·∫¢N QUY·ªÄN</label>
        <input type="password" id="keyInput" placeholder="Nh·∫≠p key c·ªßa b·∫°n..." autocomplete="off" disabled />
      </div>
      
      <button class="btn-auth" id="authBtn" onclick="checkKey()" disabled>ƒêANG T·∫¢I...</button>
      
      <div class="error-message" id="errorMsg"></div>
      
      <div style="margin-top: 25px; text-align: center; color: #718096; font-size: 12px;">
        <div>üìå Key ƒë∆∞·ª£c t·∫£i t·ª´ file <strong style="color:#81e6d9">key.json</strong></div>
        <div style="margin-top: 5px;">üîÑ T·ª± ƒë·ªông ki·ªÉm tra th·ªùi h·∫°n</div>
      </div>
    </div>
  </div>

  <!-- MAIN APP -->
  <div id="mainApp">
    <iframe src="https://web.sunwin.moi/?affId=Sunwin" allowfullscreen></iframe>
    
    <div id="robotBox">
      <img id="robotIcon" src="https://iqai.com/_next/image?url=/gifs/home/robotics.gif&w=828&q=75" />
      <div id="predictionCard">
        <div id="phien">#...</div>
        <div id="duDoan">ƒêang kh·ªüi ƒë·ªông AI...</div>
        <div id="cauStatus">Kh·ªüi t·∫°o m√¥ h√¨nh</div>
      </div>
    </div>
    
    <audio id="soundTai" src="https://assets.mixkit.co/sfx/preview/mixkit-game-ball-tap-2073.mp3"></audio>
    <audio id="soundXiu" src="https://assets.mixkit.co/sfx/preview/mixkit-game-click-1114.mp3"></audio>
    
    <button id="logoutBtn" onclick="logout()">ƒêƒÇNG XU·∫§T</button>
    <div id="copyright">¬© Tool by KhoiNguyen X KenR6 | Key: <span id="currentKey"></span></div>
  </div>

  <script>
    // ===== BI·∫æN TO√ÄN C·ª§C =====
    let validKeys = [];
    let keyDataLoaded = false;

    // ===== T·∫¢I DANH S√ÅCH KEY T·ª™ FILE JSON =====
    async function loadKeysFromJSON() {
      try {
        const response = await fetch('key.json');
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: Kh√¥ng th·ªÉ t·∫£i key.json`);
        }
        
        const data = await response.json();
        
        if (data && Array.isArray(data.keys)) {
          validKeys = data.keys;
          keyDataLoaded = true;
          document.getElementById('loadingStatus').textContent = '‚úÖ ƒê√£ t·∫£i danh s√°ch key th√†nh c√¥ng';
          document.getElementById('keyInput').disabled = false;
          document.getElementById('authBtn').disabled = false;
          document.getElementById('authBtn').textContent = 'X√ÅC TH·ª∞C & V√ÄO C√îNG C·ª§';
          
          // Hi·ªÉn th·ªã s·ªë l∆∞·ª£ng key c√≥ s·∫µn
          document.getElementById('loadingStatus').innerHTML += 
            ` <small style="color:#f6ad55">(${validKeys.length} key)</small>`;
        } else {
          throw new Error('C·∫•u tr√∫c key.json kh√¥ng h·ª£p l·ªá');
        }
      } catch (error) {
        console.error('L·ªói t·∫£i key.json:', error);
        document.getElementById('loadingStatus').innerHTML = 
          `‚ùå L·ªói t·∫£i key.json: ${error.message}`;
        document.getElementById('errorMsg').innerHTML = 
          'Vui l√≤ng ƒë·∫£m b·∫£o file key.json t·ªìn t·∫°i v√† c√≥ c·∫•u tr√∫c ƒë√∫ng.<br>' +
          '<small>File m·∫´u: {"keys":[{"key":"ABC123","expires":"2025-12-31","user":"Test"}]}</small>';
        
        // Fallback: S·ª≠ d·ª•ng key m·∫∑c ƒë·ªãnh n·∫øu kh√¥ng t·∫£i ƒë∆∞·ª£c file
        setTimeout(() => {
          validKeys = [
            { key: "TEST123", expires: "2024-12-31", user: "FallbackUser" }
          ];
          keyDataLoaded = true;
          document.getElementById('loadingStatus').textContent = '‚ö†Ô∏è ƒêang d√πng key m·∫∑c ƒë·ªãnh (fallback)';
          document.getElementById('keyInput').disabled = false;
          document.getElementById('authBtn').disabled = false;
          document.getElementById('authBtn').textContent = 'X√ÅC TH·ª∞C (FALLBACK)';
        }, 3000);
      }
    }

    // ===== KI·ªÇM TRA KEY =====
    function checkKey() {
      if (!keyDataLoaded) {
        document.getElementById("errorMsg").textContent = "‚è≥ Vui l√≤ng ƒë·ª£i t·∫£i danh s√°ch key...";
        return;
      }
      
      const input = document.getElementById("keyInput").value.trim();
      const errorMsg = document.getElementById("errorMsg");
      
      errorMsg.textContent = "";
      
      if (!input) {
        errorMsg.textContent = "‚ö†Ô∏è Vui l√≤ng nh·∫≠p key!";
        return;
      }
      
      // T√¨m key trong danh s√°ch
      const foundKey = validKeys.find(k => k.key === input);
      
      if (!foundKey) {
        errorMsg.textContent = "‚ùå Key kh√¥ng t·ªìn t·∫°i trong h·ªá th·ªëng!";
        return;
      }
      
      // Ki·ªÉm tra ng√†y h·∫øt h·∫°n
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const expireDate = new Date(foundKey.expires);
      
      if (today > expireDate) {
        errorMsg.textContent = `‚è∞ Key ƒë√£ h·∫øt h·∫°n t·ª´ ${foundKey.expires}!`;
        return;
      }
      
      // T√≠nh s·ªë ng√†y c√≤n l·∫°i
      const daysLeft = Math.ceil((expireDate - today) / (1000 * 60 * 60 * 24));
      
      // L∆∞u th√¥ng tin
      localStorage.setItem("authKey", input);
      localStorage.setItem("authUser", foundKey.user || "Unknown");
      localStorage.setItem("authExpires", foundKey.expires);
      localStorage.setItem("authDaysLeft", daysLeft);
      
      showMainApp();
    }

    // ===== HI·ªÇN TH·ªä APP CH√çNH =====
    function showMainApp() {
      document.getElementById("authScreen").style.display = "none";
      document.getElementById("mainApp").style.display = "block";
      
      // Hi·ªÉn th·ªã th√¥ng tin key
      const currentKey = localStorage.getItem("authKey");
      const daysLeft = localStorage.getItem("authDaysLeft");
      document.getElementById("currentKey").textContent = 
        `${currentKey} (c√≤n ${daysLeft} ng√†y)`;
      
      runTool(); // Kh·ªüi ch·∫°y c√¥ng c·ª• d·ª± ƒëo√°n
    }

    // ===== KI·ªÇM TRA ƒê√É ƒêƒÇNG NH·∫¨P CH∆ØA =====
    async function checkAuth() {
      const savedKey = localStorage.getItem("authKey");
      const savedExpires = localStorage.getItem("authExpires");
      
      if (!savedKey || !savedExpires) {
        return;
      }
      
      // Ch·ªù t·∫£i key.json tr∆∞·ªõc
      await loadKeysFromJSON();
      
      // Ki·ªÉm tra trong danh s√°ch key hi·ªán t·∫°i
      const foundKey = validKeys.find(k => k.key === savedKey && k.expires === savedExpires);
      
      if (foundKey) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const expireDate = new Date(savedExpires);
        
        if (today <= expireDate) {
          showMainApp();
        } else {
          // Key h·∫øt h·∫°n
          logout();
          document.getElementById("errorMsg").textContent = "‚è∞ Key ƒë√£ h·∫øt h·∫°n, vui l√≤ng nh·∫≠p key m·ªõi";
        }
      }
    }

    // ===== ƒêƒÇNG XU·∫§T =====
    function logout() {
      localStorage.removeItem("authKey");
      localStorage.removeItem("authUser");
      localStorage.removeItem("authExpires");
      localStorage.removeItem("authDaysLeft");
      
      document.getElementById("mainApp").style.display = "none";
      document.getElementById("authScreen").style.display = "flex";
      document.getElementById("keyInput").value = "";
      document.getElementById("errorMsg").textContent = "";
    }

    // ===== C√îNG C·ª§ D·ª∞ ƒêO√ÅN =====
    const apiUrl = 'https://sunlaymaynk.hacksieucap.pro/sunlon';
    let previousPhien = null;

    function runTool() {
      fetchData();
      setInterval(fetchData, 5000);

      const box = document.getElementById("robotBox");
      let drag = false, ox = 0, oy = 0;

      box.onmousedown = e => {
        drag = true;
        ox = e.clientX - box.offsetLeft;
        oy = e.clientY - box.offsetTop;
      };

      document.onmousemove = e => {
        if (!drag) return;
        box.style.left = e.clientX - ox + "px";
        box.style.top = e.clientY - oy + "px";
      };

      document.onmouseup = () => drag = false;
    }

    async function fetchData() {
      try {
        const res = await fetch(apiUrl);
        const data = await res.json();

        if (data.phien !== previousPhien) {
          previousPhien = data.phien;

          document.getElementById("phien").innerText = "Phi√™n #" + (parseInt(data.phien) + 1);
          document.getElementById("duDoan").innerText = "ƒêang ph√¢n t√≠ch...";
          document.getElementById("cauStatus").innerText = "AI ƒëang x·ª≠ l√Ω d·ªØ li·ªáu";

          setTimeout(() => updateDuDoan(data.du_doan), 8000);
        }
      } catch {
        document.getElementById("duDoan").innerText = "L·ªói API";
      }
    }

    function updateDuDoan(kq) {
      const el = document.getElementById("duDoan");
      el.classList.remove("du-doan-tai", "du-doan-xiu");

      if (kq && kq.toLowerCase().includes("t√†i")) {
        el.innerText = "D·ª± ƒëo√°n: T√†i";
        el.classList.add("du-doan-tai");
        document.getElementById("soundTai").play().catch(()=>{});
      } else {
        el.innerText = "D·ª± ƒëo√°n: X·ªâu";
        el.classList.add("du-doan-xiu");
        document.getElementById("soundXiu").play().catch(()=>{});
      }

      document.getElementById("cauStatus").innerText = "AI x√°c su·∫•t cao";
    }

    // ===== KH·ªûI ƒê·ªòNG =====
    window.onload = function() {
      loadKeysFromJSON();
      
      // Enter ƒë·ªÉ x√°c th·ª±c
      document.getElementById("keyInput").addEventListener("keypress", function(e) {
        if (e.key === "Enter" && !this.disabled) checkKey();
      });
      
      // Ki·ªÉm tra auth sau khi t·∫£i key
      setTimeout(() => {
        if (keyDataLoaded) checkAuth();
      }, 500);
    };
  </script>
</body>
</html>
