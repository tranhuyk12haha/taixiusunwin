<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title> SunWin VIP </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <link rel="icon" href="https://iqai.com/_next/image?url=/gifs/home/robotics.gif&w=828&q=75" type="image/png" />
  
  <style>
    /* (To√†n b·ªô ph·∫ßn CSS gi·ªØ nguy√™n nh∆∞ code tr∆∞·ªõc, b·∫°n c√≥ th·ªÉ copy t·ª´ c√¢u tr·∫£ l·ªùi tr√™n) */
    * { box-sizing: border-box; }
    body { margin: 0; background: #0f2a33; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial; overflow: hidden; }
    #authScreen { position: fixed; inset: 0; background: linear-gradient(135deg, #0f2a33, #1a3a45); z-index: 10000; display: flex; justify-content: center; align-items: center; padding: 20px; }
    .auth-box { background: rgba(10, 25, 30, 0.98); border-radius: 16px; padding: 40px 35px; width: 100%; max-width: 450px; border: 1px solid rgba(79, 209, 197, 0.4); box-shadow: 0 0 40px rgba(79, 209, 197, 0.35), inset 0 0 20px rgba(79, 209, 197, 0.15); }
    .logo img { width: 75px; border-radius: 50%; filter: drop-shadow(0 0 12px #4fd1c5); display: block; margin: 0 auto 25px; }
    h1 { color: #81e6d9; text-align: center; margin-bottom: 8px; font-size: 22px; text-shadow: 0 0 8px rgba(79,209,197,0.7); }
    .subtitle { color: #a0aec0; text-align: center; font-size: 14px; margin-bottom: 30px; }
    .input-group { margin-bottom: 20px; }
    label { display: block; color: #81e6d9; font-size: 14px; font-weight: 600; margin-bottom: 8px; text-shadow: 0 0 4px rgba(79,209,197,0.5); }
    input { width: 100%; padding: 14px 16px; background: rgba(15, 42, 51, 0.8); border: 2px solid rgba(79, 209, 197, 0.4); border-radius: 10px; color: #e6fffa; font-size: 16px; outline: none; transition: all 0.3s; }
    input:focus { border-color: #4fd1c5; box-shadow: 0 0 15px rgba(79, 209, 197, 0.5); }
    .btn-auth { width: 100%; padding: 15px; background: linear-gradient(135deg, #4fd1c5, #38b2ac); border: none; border-radius: 10px; color: #0f2a33; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s; margin-top: 10px; }
    .btn-auth:hover { background: linear-gradient(135deg, #38f9d7, #4fd1c5); box-shadow: 0 0 20px rgba(79, 209, 197, 0.7); }
    .btn-auth:disabled { opacity: 0.6; cursor: not-allowed; }
    .error-message { color: #fc8181; text-align: center; font-size: 14px; margin-top: 15px; min-height: 20px; text-shadow: 0 0 4px rgba(252, 129, 129, 0.5); }
    .loading { color: #81e6d9; text-align: center; font-size: 14px; margin: 15px 0; }
    #mainApp { display: none; }
    iframe { position: fixed; inset: 0; width: 100%; height: 100%; border: none; z-index: 1; }
    #robotBox { position: fixed; top: 90px; left: 20px; z-index: 9999; display: flex; align-items: center; gap: 12px; cursor: move; user-select: none; padding: 12px 16px; border-radius: 20px; background: linear-gradient(135deg, rgba(79,209,197,0.18), rgba(56,178,172,0.12)); backdrop-filter: blur(10px); border: 1px solid rgba(79,209,197,0.35); box-shadow: 0 0 15px rgba(79,209,197,0.5), 0 0 35px rgba(79,209,197,0.25); }
    #robotIcon { width: 70px; filter: drop-shadow(0 0 10px #4fd1c5) drop-shadow(0 0 20px #38b2ac); }
    #predictionCard { background: linear-gradient(180deg, rgba(10,25,30,0.95), rgba(5,15,20,0.98)); border-radius: 14px; padding: 12px 16px; min-width: 200px; border: 1px solid rgba(79,209,197,0.3); box-shadow: inset 0 0 12px rgba(79,209,197,0.15), 0 0 20px rgba(79,209,197,0.25); }
    #phien { color: #81e6d9; font-size: 13px; font-weight: 600; margin-bottom: 4px; text-shadow: 0 0 6px rgba(79,209,197,0.6); }
    #duDoan { font-size: 18px; font-weight: 800; color: #e6fffa; text-shadow: 0 0 8px rgba(79,209,197,0.9), 0 0 16px rgba(79,209,197,0.6); }
    #cauStatus { color: #a0aec0; font-size: 11px; font-style: italic; margin-top: 4px; }
    .du-doan-tai { color: #38f9d7 !important; text-shadow: 0 0 10px rgba(56,249,215,0.9), 0 0 20px rgba(56,249,215,0.6); }
    .du-doan-xiu { color: #f6ad55 !important; text-shadow: 0 0 10px rgba(246,173,85,0.9), 0 0 20px rgba(246,173,85,0.6); }
    #copyright { position: fixed; bottom: 10px; right: 10px; color: #81e6d9; font-size: 11px; z-index: 9999; opacity: 0.85; user-select: none; }
    #logoutBtn { position: fixed; top: 20px; right: 20px; z-index: 10000; padding: 8px 16px; background: rgba(10, 25, 30, 0.9); border: 1px solid rgba(252, 129, 129, 0.4); border-radius: 8px; color: #fc8181; font-size: 12px; cursor: pointer; transition: all 0.3s; }
    #logoutBtn:hover { background: rgba(252, 129, 129, 0.1); border-color: #fc8181; box-shadow: 0 0 10px rgba(252, 129, 129, 0.4); }
  </style>
</head>

<body>
  <!-- AUTH SCREEN -->
  <div id="authScreen">
    <div class="auth-box">
      <div class="logo">
        <img src="https://iqai.com/_next/image?url=/gifs/home/robotics.gif&w=828&q=75" alt="AI Robot" />
      </div>
      <h1>üîê TRUY C·∫¨P VIP</h1>
      <p class="subtitle">Nh·∫≠p key b·∫£n quy·ªÅn ƒë·ªÉ s·ª≠ d·ª•ng c√¥ng c·ª•</p>
      
      <div class="loading" id="loadingStatus">üì° ƒêang k·∫øt n·ªëi GitHub...</div>
      
      <div class="input-group">
        <label for="keyInput">KEY B·∫¢N QUY·ªÄN</label>
        <input type="password" id="keyInput" placeholder="Nh·∫≠p key c·ªßa b·∫°n..." autocomplete="off" disabled />
      </div>
      
      <button class="btn-auth" id="authBtn" onclick="checkKey()" disabled>ƒêANG T·∫¢I DANH S√ÅCH KEY...</button>
      
      <div class="error-message" id="errorMsg"></div>
      
      <div style="margin-top: 25px; text-align: center; color: #718096; font-size: 12px;">
        <div>üìå Key ƒë∆∞·ª£c t·∫£i t·ª´ <strong style="color:#81e6d9">GitHub RAW</strong></div>
        <div style="margin-top: 5px;">üîÑ Lu√¥n c·∫≠p nh·∫≠t danh s√°ch m·ªõi nh·∫•t</div>
      </div>
    </div>
  </div>

  <!-- MAIN APP -->
  <div id="mainApp">
    <iframe src="https://web.sunwin.moi/?affId=Sunwin" allowfullscreen></iframe>
    
    <div id="robotBox">
      <img id="robotIcon" src="https://iqai.com/_next/image?url=/gifs/home/robotics.gif&w=828&q=75" />
      <div id="predictionCard">
        <div id="phien">#...</div>
        <div id="duDoan">ƒêang kh·ªüi ƒë·ªông AI...</div>
        <div id="cauStatus">Kh·ªüi t·∫°o m√¥ h√¨nh</div>
      </div>
    </div>
    
    <audio id="soundTai" src="https://assets.mixkit.co/sfx/preview/mixkit-game-ball-tap-2073.mp3"></audio>
    <audio id="soundXiu" src="https://assets.mixkit.co/sfx/preview/mixkit-game-click-1114.mp3"></audio>
    
    <button id="logoutBtn" onclick="logout()">ƒêƒÇNG XU·∫§T</button>
    <div id="copyright">¬© Tool by KhoiNguyen X KenR6 | Key: <span id="currentKey"></span></div>
  </div>

  <script>
    // ===== BI·∫æN TO√ÄN C·ª§C =====
    let validKeys = [];
    let keyDataLoaded = false;

    // ===== LINK RAW GITHUB C·ª¶A B·∫†N =====
    const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/tranhuyk12haha/taixiusunwin/main/key.json';

    // ===== T·∫¢I DANH S√ÅCH KEY T·ª™ GITHUB RAW =====
    async function loadKeysFromGitHub() {
      try {
        // Th√™m timestamp ƒë·ªÉ tr√°nh cache tr√¨nh duy·ªát
        const urlWithNoCache = `${GITHUB_RAW_URL}?t=${new Date().getTime()}`;
        document.getElementById('loadingStatus').textContent = 'üì° ƒêang t·∫£i key...';
        
        const response = await fetch(urlWithNoCache);
        
        if (!response.ok) {
          throw new Error(`L·ªói m·∫°ng: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data && Array.isArray(data.keys)) {
          validKeys = data.keys;
          keyDataLoaded = true;
          document.getElementById('loadingStatus').innerHTML = 
            `‚úÖ ƒê√£ t·∫£i <strong>${validKeys.length}</strong> key`;
          document.getElementById('keyInput').disabled = false;
          document.getElementById('authBtn').disabled = false;
          document.getElementById('authBtn').textContent = 'X√ÅC TH·ª∞C & V√ÄO TOOL';
          
          // Hi·ªÉn th·ªã m·ªôt v√†i key m·∫´u (·∫©n b·ªõt k√Ω t·ª±)
          if (validKeys.length > 0) {
            const sampleKey = validKeys[0].key;
            const maskedKey = sampleKey.substring(0, 3) + '***' + sampleKey.substring(sampleKey.length - 3);
            document.getElementById('loadingStatus').innerHTML += 
              `<br><small>V√≠ d·ª•: ${maskedKey} (h·∫øt h·∫°n: ${validKeys[0].expires})</small>`;
          }
        } else {
          throw new Error('C·∫•u tr√∫c JSON kh√¥ng h·ª£p l·ªá');
        }
      } catch (error) {
        console.error('L·ªói t·∫£i t·ª´ GitHub:', error);
        document.getElementById('loadingStatus').innerHTML = 
          `‚ùå L·ªói t·∫£i t·ª´ GitHub: ${error.message}`;
        document.getElementById('errorMsg').innerHTML = 
          'ƒêang th·ª≠ t·∫£i l·∫°i sau 5 gi√¢y...<br><small>Ki·ªÉm tra k·∫øt n·ªëi internet</small>';
        
        // T·ª± ƒë·ªông th·ª≠ l·∫°i sau 5 gi√¢y
        setTimeout(loadKeysFromGitHub, 5000);
        
        // Fallback c·ª©ng n·∫øu c·∫ßn
        validKeys = [
          { key: "CHAMAY", expires: "2026-12-22", user: "KhachHangVIP" },
          { key: "kENR6DEPTRAI1DAY", expires: "2025-12-20", user: "Tester24h" }
        ];
        keyDataLoaded = true;
        document.getElementById('keyInput').disabled = false;
        document.getElementById('authBtn').disabled = false;
        document.getElementById('authBtn').textContent = 'X√ÅC TH·ª∞C (D·ª∞ PH√íNG)';
        document.getElementById('loadingStatus').innerHTML += '<br><small>‚ö†Ô∏è ƒêang d√πng b·∫£n sao d·ª± ph√≤ng</small>';
      }
    }

    // ===== KI·ªÇM TRA KEY =====
    function checkKey() {
      if (!keyDataLoaded) {
        document.getElementById("errorMsg").textContent = "‚è≥ Vui l√≤ng ƒë·ª£i t·∫£i danh s√°ch key...";
        return;
      }
      
      const input = document.getElementById("keyInput").value.trim();
      const errorMsg = document.getElementById("errorMsg");
      
      errorMsg.textContent = "";
      
      if (!input) {
        errorMsg.textContent = "‚ö†Ô∏è Vui l√≤ng nh·∫≠p key!";
        return;
      }
      
      // T√¨m key trong danh s√°ch
      const foundKey = validKeys.find(k => k.key === input);
      
      if (!foundKey) {
        errorMsg.textContent = "‚ùå Key kh√¥ng t·ªìn t·∫°i trong h·ªá th·ªëng!";
        // G·ª£i √Ω key g·∫ßn ƒë√∫ng
        const similarKey = validKeys.find(k => 
          k.key.toLowerCase().includes(input.toLowerCase()) || 
          input.toLowerCase().includes(k.key.toLowerCase())
        );
        if (similarKey) {
          errorMsg.textContent += ` G·ª£i √Ω: ${similarKey.key.substring(0, 3)}...`;
        }
        return;
      }
      
      // Ki·ªÉm tra ng√†y h·∫øt h·∫°n
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const expireDate = new Date(foundKey.expires);
      
      if (today > expireDate) {
        errorMsg.textContent = `‚è∞ Key ƒë√£ h·∫øt h·∫°n t·ª´ ${foundKey.expires}!`;
        return;
      }
      
      // T√≠nh s·ªë ng√†y c√≤n l·∫°i
      const daysLeft = Math.ceil((expireDate - today) / (1000 * 60 * 60 * 24));
      
      // L∆∞u th√¥ng tin
      localStorage.setItem("authKey", input);
      localStorage.setItem("authUser", foundKey.user || "Unknown");
      localStorage.setItem("authExpires", foundKey.expires);
      localStorage.setItem("authDaysLeft", daysLeft);
      localStorage.setItem("lastKeyUpdate", new Date().toISOString());
      
      showMainApp();
    }

    // ===== HI·ªÇN TH·ªä APP CH√çNH =====
    function showMainApp() {
      document.getElementById("authScreen").style.display = "none";
      document.getElementById("mainApp").style.display = "block";
      
      // Hi·ªÉn th·ªã th√¥ng tin key
      const currentKey = localStorage.getItem("authKey");
      const daysLeft = localStorage.getItem("authDaysLeft");
      const lastUpdate = localStorage.getItem("lastKeyUpdate");
      const updateTime = lastUpdate ? new Date(lastUpdate).toLocaleTimeString('vi-VN') : 'v·ª´a xong';
      
      document.getElementById("currentKey").innerHTML = 
        `${currentKey} (c√≤n ${daysLeft} ng√†y) <small style="color:#a0aec0">| C·∫≠p nh·∫≠t: ${updateTime}</small>`;
      
      runTool(); // Kh·ªüi ch·∫°y c√¥ng c·ª• d·ª± ƒëo√°n
    }

    // ===== KI·ªÇM TRA ƒê√É ƒêƒÇNG NH·∫¨P CH∆ØA (V·ªöI KEY C≈®) =====
    async function checkAuth() {
      const savedKey = localStorage.getItem("authKey");
      const savedExpires = localStorage.getItem("authExpires");
      
      if (!savedKey || !savedExpires) {
        return;
      }
      
      // LU√îN t·∫£i key m·ªõi t·ª´ GitHub tr∆∞·ªõc khi ki·ªÉm tra
      await loadKeysFromGitHub();
      
      // Ki·ªÉm tra trong danh s√°ch key m·ªõi t·∫£i v·ªÅ
      const foundKey = validKeys.find(k => k.key === savedKey && k.expires === savedExpires);
      
      if (foundKey) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const expireDate = new Date(savedExpires);
        
        if (today <= expireDate) {
          // C·∫≠p nh·∫≠t l·∫°i th√¥ng tin ng√†y
          const daysLeft = Math.ceil((expireDate - today) / (1000 * 60 * 60 * 24));
          localStorage.setItem("authDaysLeft", daysLeft);
          localStorage.setItem("lastKeyUpdate", new Date().toISOString());
          
          showMainApp();
        } else {
          // Key h·∫øt h·∫°n
          logout();
          document.getElementById("errorMsg").textContent = "‚è∞ Key ƒë√£ h·∫øt h·∫°n, vui l√≤ng nh·∫≠p key m·ªõi";
        }
      } else {
        // Key kh√¥ng c√≤n trong danh s√°ch m·ªõi
        logout();
        document.getElementById("errorMsg").textContent = "üîë Key ƒë√£ b·ªã thu h·ªìi ho·∫∑c thay ƒë·ªïi";
      }
    }

    // ===== ƒêƒÇNG XU·∫§T =====
    function logout() {
      localStorage.removeItem("authKey");
      localStorage.removeItem("authUser");
      localStorage.removeItem("authExpires");
      localStorage.removeItem("authDaysLeft");
      
      document.getElementById("mainApp").style.display = "none";
      document.getElementById("authScreen").style.display = "flex";
      document.getElementById("keyInput").value = "";
      document.getElementById("errorMsg").textContent = "";
      document.getElementById("keyInput").focus();
    }

    // ===== L√ÄM M·ªöI DANH S√ÅCH KEY (n√∫t ·∫©n) =====
    function refreshKeys() {
      document.getElementById("authBtn").disabled = true;
      document.getElementById("authBtn").textContent = "ƒêANG L√ÄM M·ªöI...";
      document.getElementById("loadingStatus").textContent = "üîÑ ƒêang t·∫£i danh s√°ch key m·ªõi...";
      document.getElementById("errorMsg").textContent = "";
      keyDataLoaded = false;
      
      loadKeysFromGitHub();
    }

    // ===== C√îNG C·ª§ D·ª∞ ƒêO√ÅN =====
    const apiUrl = 'https://sunlaymaynk.hacksieucap.pro/sunlon';
    let previousPhien = null;

    function runTool() {
      fetchData();
      setInterval(fetchData, 5000);

      const box = document.getElementById("robotBox");
      let drag = false, ox = 0, oy = 0;

      box.onmousedown = e => {
        drag = true;
        ox = e.clientX - box.offsetLeft;
        oy = e.clientY - box.offsetTop;
      };

      document.onmousemove = e => {
        if (!drag) return;
        box.style.left = e.clientX - ox + "px";
        box.style.top = e.clientY - oy + "px";
      };

      document.onmouseup = () => drag = false;
    }

    async function fetchData() {
      try {
        const res = await fetch(apiUrl);
        const data = await res.json();

        if (data.phien !== previousPhien) {
          previousPhien = data.phien;

          document.getElementById("phien").innerText = "Phi√™n #" + (parseInt(data.phien) + 1);
          document.getElementById("duDoan").innerText = "ƒêang ph√¢n t√≠ch...";
          document.getElementById("cauStatus").innerText = "AI ƒëang x·ª≠ l√Ω d·ªØ li·ªáu";

          setTimeout(() => updateDuDoan(data.du_doan), 8000);
        }
      } catch {
        document.getElementById("duDoan").innerText = "L·ªói API";
      }
    }

    function updateDuDoan(kq) {
      const el = document.getElementById("duDoan");
      el.classList.remove("du-doan-tai", "du-doan-xiu");

      if (kq && kq.toLowerCase().includes("t√†i")) {
        el.innerText = "D·ª± ƒëo√°n: T√†i";
        el.classList.add("du-doan-tai");
        document.getElementById("soundTai").play().catch(()=>{});
      } else {
        el.innerText = "D·ª± ƒëo√°n: X·ªâu";
        el.classList.add("du-doan-xiu");
        document.getElementById("soundXiu").play().catch(()=>{});
      }

      document.getElementById("cauStatus").innerText = "AI x√°c su·∫•t cao";
    }

    // ===== KH·ªûI ƒê·ªòNG =====
    window.onload = function() {
      // T·∫£i key t·ª´ GitHub ngay khi m·ªü trang
      loadKeysFromGitHub();
      
      // Ph√≠m t·∫Øt: Enter ƒë·ªÉ x√°c th·ª±c, Ctrl+R ƒë·ªÉ refresh key
      document.getElementById("keyInput").addEventListener("keypress", function(e) {
        if (e.key === "Enter" && !this.disabled) checkKey();
      });
      
      document.addEventListener("keydown", function(e) {
        if (e.ctrlKey && e.key === "r") {
          e.preventDefault();
          refreshKeys();
        }
      });
      
      // Ki·ªÉm tra auth sau khi t·∫£i key xong
      setTimeout(() => {
        if (keyDataLoaded) checkAuth();
      }, 800);
      
      // T·ª± ƒë·ªông focus v√†o √¥ nh·∫≠p key
      setTimeout(() => {
        const keyInput = document.getElementById("keyInput");
        if (!keyInput.disabled) keyInput.focus();
      }, 1000);
    };
  </script>
</body>
</html>
